services:
  mongo:
    image: mongo:6
    volumes:
      - ./data/mongo:/data/db
    deploy:
      restart_policy:
        condition: any
    networks:
      - easypanel

  backend:
    image: menindata-backend   # <--- use prebuilt image
    environment:
      - MONGO_URL=mongodb://mongo:27017/mydb
    volumes:
      - ./uploads:/app/uploads
    deploy:
      labels:
        - traefik.enable=true
        - traefik.http.routers.menindata-backend.rule=Host(`menindata.in`) && PathPrefix(`/api`)
        - traefik.http.routers.menindata-backend.entrypoints=websecure
        - traefik.http.routers.menindata-backend.tls=true
        - traefik.http.services.menindata-backend.loadbalancer.server.port=8001
      restart_policy:
        condition: any
    networks:
      - easypanel

  frontend:
    image: menindata-frontend   # <--- use prebuilt image
    deploy:
      labels:
        - traefik.enable=true
        - traefik.http.routers.menindata-frontend.rule=Host(`menindata.in`)
        - traefik.http.routers.menindata-frontend.entrypoints=websecure
        - traefik.http.routers.menindata-frontend.tls=true
        - traefik.http.services.menindata-frontend.loadbalancer.server.port=3000
      restart_policy:
        condition: any
    networks:
      - easypanel

networks:
  easypanel:
    external: true
